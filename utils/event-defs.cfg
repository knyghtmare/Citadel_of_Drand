#textdomain wesnoth-cod

#define PASSABLE_CHECK
    [+unit]
        placement=map
        passable=yes
    [/unit]
#enddef

# for attacker side(s) to enter and leave the battle zone
#define SET_UP_TUNNELS
    # battle zone tunnels
    [tunnel]
        [filter]
            side=1,3,5,7
        [/filter]

        [source]
            x=31
            y=5
        [/source]
        [target]
            x=23,31
            y= 8, 8
        [/target]

        allow_vision=yes
        bidirectional=yes
    [/tunnel]

    [tunnel]
        [filter]
            side=1,3,5,7
        [/filter]

        [source]
            x=34
            y=6
        [/source]
        [target]
            x=34,37
            y=10,16
        [/target]

        allow_vision=yes
        bidirectional=yes
    [/tunnel]

    [tunnel]
        [filter]
            side=1,3,5,7
        [/filter]

        [source]
            x=36
            y=33
        [/source]
        [target]
            x=37,34
            y=25,30
        [/target]

        allow_vision=yes
        bidirectional=yes
    [/tunnel]

    [tunnel]
        [filter]
            side=1,3,5,7
        [/filter]

        [source]
            x=32
            y=36
        [/source]
        [target]
            x=32,24
            y=33,33
        [/target]

        allow_vision=yes
        bidirectional=yes
    [/tunnel]

    [tunnel]
        [filter]
            side=1,3,5,7
        [/filter]

        [source]
            x=8
            y=35
        [/source]
        [target]
            x=18,10
            y=33,33
        [/target]

        allow_vision=yes
        bidirectional=yes
    [/tunnel]

    [tunnel]
        [filter]
            side=1,3,5,7
        [/filter]

        [source]
            x=5
            y=33
        [/source]
        [target]
            x= 6, 7
            y=29,24
        [/target]

        allow_vision=yes
        bidirectional=yes
    [/tunnel]

    [tunnel]
        [filter]
            side=1,3,5,7
        [/filter]

        [source]
            x=6
            y=8
        [/source]
        [target]
            x= 7, 6
            y=18,12
        [/target]

        allow_vision=yes
        bidirectional=yes
    [/tunnel]

    [tunnel]
        [filter]
            side=1,3,5,7
        [/filter]

        [source]
            x=10
            y=5
        [/source]
        [target]
            x=10,20
            y= 8, 8
        [/target]

        allow_vision=yes
        bidirectional=yes
    [/tunnel]

    # base to base tunnels
    [tunnel]
        [filter]
            side=1,3,5,7
        [/filter]

        [source]
            x=27
            y=4
        [/source]
        [target]
            x=24
            y=3
        [/target]

        allow_vision=yes
        bidirectional=yes
    [/tunnel]

    [tunnel]
        [filter]
            side=1,3,5,7
        [/filter]

        [source]
            x=16
            y=4
        [/source]
        [target]
            x=12
            y=3
        [/target]

        allow_vision=yes
        bidirectional=yes
    [/tunnel]

    [tunnel]
        [filter]
            side=1,3,5,7
        [/filter]

        [source]
            x=4
            y=10
        [/source]
        [target]
            x=3
            y=31
        [/target]

        allow_vision=yes
        bidirectional=yes
    [/tunnel]

    [tunnel]
        [filter]
            side=1,3,5,7
        [/filter]

        [source]
            x=15
            y=38
        [/source]
        [target]
            x=18
            y=37
        [/target]

        allow_vision=yes
        bidirectional=yes
    [/tunnel]

    [tunnel]
        [filter]
            side=1,3,5,7
        [/filter]

        [source]
            x=27
            y=40
        [/source]
        [target]
            x=30
            y=38
        [/target]

        allow_vision=yes
        bidirectional=yes
    [/tunnel]

    [tunnel]
        [filter]
            side=1,3,5,7
        [/filter]

        [source]
            x=39
            y=31
        [/source]
        [target]
            x=38
            y=10
        [/target]

        allow_vision=yes
        bidirectional=yes
    [/tunnel]
#enddef

#define SET_UP_SCENARIO_LABELS
    {PLACE_DETAILED_LABEL 2 21 (_"Attacker Conduit") attackers {COLOR_MAIN_LABEL_THREE} (1,3,5,7) (_"Conduit A")}

    {PLACE_DETAILED_LABEL 40 20 (_"Attacker Conduit") attackers {COLOR_MAIN_LABEL_THREE} (1,3,5,7) (_"Conduit B")}

    {PLACE_DETAILED_LABEL 3 31 (_"To NW Base") attackers {COLOR_MAIN_LABEL_TWO} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 4 10 (_"To SW Base") attackers {COLOR_MAIN_LABEL_TWO} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 5 33 (_"Area E") attackers {COLOR_MAIN_LABEL_ONE} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 6 8 (_"Area D") attackers {COLOR_MAIN_LABEL_ONE} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 7 38 (_"South-Western Base") attackers {COLOR_MAIN_LABEL_THREE} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 8 4 (_"North-Western Base") attackers {COLOR_MAIN_LABEL_THREE} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 31 3 (_"North-Eastern Base") attackers {COLOR_MAIN_LABEL_THREE} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 38 34 (_"South-Eastern Base") attackers {COLOR_MAIN_LABEL_THREE} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 8 35 (_"Area F") attackers {COLOR_MAIN_LABEL_ONE} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 10 5 (_"Area C") attackers {COLOR_MAIN_LABEL_ONE} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 12 3 (_"To NE Base") attackers {COLOR_MAIN_LABEL_TWO} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 15 38 (_"To SE Base") attackers {COLOR_MAIN_LABEL_TWO} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 16 4 (_"To NW Base") attackers {COLOR_MAIN_LABEL_TWO} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 18 2 (_"Shop A") attackers {COLOR_MAIN_LABEL_THREE} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 20 40 (_"Shop B") attackers {COLOR_MAIN_LABEL_THREE} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 18 37 (_"To SE Base") attackers {COLOR_MAIN_LABEL_TWO} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 24 3 (_"To NE Base") attackers {COLOR_MAIN_LABEL_TWO} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 27 4 (_"To NW Base") attackers {COLOR_MAIN_LABEL_TWO} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 27 40 (_"To SE Base") attackers {COLOR_MAIN_LABEL_TWO} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 30 38 (_"To SW Base") attackers {COLOR_MAIN_LABEL_TWO} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 31 5 (_"Area A") attackers {COLOR_MAIN_LABEL_ONE} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 32 36 (_"Area G") attackers {COLOR_MAIN_LABEL_ONE} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 34 6 (_"Area B") attackers {COLOR_MAIN_LABEL_ONE} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 36 33 (_"Area H") attackers {COLOR_MAIN_LABEL_ONE} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 38 10 (_"To SE Base") attackers {COLOR_MAIN_LABEL_TWO} (1,3,5,7) ()}

    {PLACE_DETAILED_LABEL 39 31 (_"To NE Base") attackers {COLOR_MAIN_LABEL_TWO} (1,3,5,7) ()}

    [label]
        x,y=21,21
        text=_"Defender Conduit"
    [/label]
#enddef

#define AI_WAVE_INFO_STRING
_"Turn 03: Knalgan Alliance
Turn 07: Undead
Turn 11: Dunefolk
Turn 15: Northerners
Turn 19: Drakes
Turn 23: Rebels"
#enddef

#define SET_UP_AI_WAVE_HELP
    [set_menu_item]
        id=MP_PVP_COD_AI_wave_info
        description=_"Scenario Help"
        image="icons/potion_green_small.png~SCALE_INTO(24,24)"
        synced=yes
        [show_if]
            {VARIABLE_CONDITIONAL turn_number greater_than 0}
        [/show_if]
        [command]
            [transient_message]
                caption= _ "AI Wave Info"
                image="icons/potion_green_small.png"
                transparent=yes
                message={AI_WAVE_INFO_STRING}
            [/transient_message]
        [/command]
    [/set_menu_item]
#enddef

#define SET_UP_DEFENDER_STARTING_VILLAGES
    [capture_village]
        x,y=18,21
        side=2
    [/capture_village]
    [capture_village]
        x,y=21,19
        side=4
    [/capture_village]
    [capture_village]
        x,y=24,20
        side=6
    [/capture_village]
    [capture_village]
        x,y=21,23
        side=8
    [/capture_village]
#enddef

#define SET_UP_DEFENDER_AI_SIDE_SPAWNS DEFENDER_SIDE_NUM
    # Labels
    {SET_LABEL  5 17 (_"Point of Interest")}
    {SET_LABEL 13 11 (_"Point of Interest")}
    {SET_LABEL  6 27 (_"Point of Interest")}
    {SET_LABEL 10 33 (_"Point of Interest")}
    {SET_LABEL 30 29 (_"Point of Interest")}
    {SET_LABEL 35 13 (_"Point of Interest")}
    {SET_LABEL 29  8 (_"Point of Interest")}

    # Naga
    [event]
        name="moveto"
        first_time_only=yes
        [filter]
            side=2,4,6,8
            x,y=5,17
        [/filter]

        {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Naga Ophidian" 5 17}
        {PASSABLE_CHECK}
        {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Naga Guard" 5 17}
        {PASSABLE_CHECK}
    [/event]

    # Drake
    [event]
        name="moveto"
        first_time_only=yes
        [filter]
            side=2,4,6,8
            x,y=13,11
        [/filter]

        {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Fire Drake" 13 11}
        {PASSABLE_CHECK}
        {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Drake Fighter" 13 11}
        {PASSABLE_CHECK}

        {IF_ALIVE 4 (
            {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Drake Fighter" 13 11}
            {PASSABLE_CHECK}
        )}

        {IF_ALIVE (6,8) (
            {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Drake Burner" 13 11}
            {PASSABLE_CHECK}
        )}
    [/event]

    # Dunefolk
    [event]
        name="moveto"
        first_time_only=yes
        [filter]
            side=2,4,6,8
            x,y=6,27
        [/filter]

        {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Dune Strider"  6 27}
        {PASSABLE_CHECK}
        {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Dune Swordsman" 6 27}
        {PASSABLE_CHECK}
        {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Dune Rover" 6 27}
        {PASSABLE_CHECK}

        {IF_ALIVE (6,8) (
            {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Dune Apothecary" 6 27}
            {PASSABLE_CHECK}
        )}
    [/event]

    # Troll
    [event]
        name="moveto"
        first_time_only=yes
        [filter]
            side=2,4,6,8
            x,y=10,33
        [/filter]

        {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Troll" 10 33}
        {PASSABLE_CHECK}
        {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Troll Whelp" 10 33}
        {PASSABLE_CHECK}
        {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Troll Shaman" 10 33}
        {PASSABLE_CHECK}

        {IF_ALIVE (6,8) (
            {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Troll Whelp" 10 33}
            {PASSABLE_CHECK}
        )}
    [/event]

    # Loyalist
    [event]
        name="moveto"
        first_time_only=yes
        [filter]
            side=2,4,6,8
            x,y=30,29
        [/filter]

        {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Red Mage" 30 29}
        {PASSABLE_CHECK}
        {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Fencer" 30 29}
        {PASSABLE_CHECK}
        {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Fencer" 30 29}
        {PASSABLE_CHECK}
        {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Cavalryman" 30 29}
        {PASSABLE_CHECK}
    [/event]

    # Elf
    [event]
        name="moveto"
        first_time_only=yes
        [filter]
            side=2,4,6,8
            x,y=35,13
        [/filter]

        {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Elvish Rider" 35 13}
        {PASSABLE_CHECK}
        {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Elvish Fighter" 35 13}
        {PASSABLE_CHECK}
        {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Elvish Shaman" 35 13}
        {PASSABLE_CHECK}

        {IF_ALIVE (6,8) (
            {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Elvish Fighter" 35 13}
            {PASSABLE_CHECK}
        )}
    [/event]

    # Bear
    [event]
        name="moveto"
        first_time_only=yes
        [filter]
            side=2,4,6,8
            x,y=29,8
        [/filter]

        {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Cave Bear" 29  8}
        {PASSABLE_CHECK}

        {IF_ALIVE (4,6,8) (
            {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Wolf" 29  8}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {DEFENDER_SIDE_NUM} "Wolf" 29  8}
            {PASSABLE_CHECK}
        )}
    [/event]
#enddef

#define SET_UP_ATTACKER_AI_SIDE_SPAWNS ATTACKER_SIDE_NUM
    [event]
        name="prestart"

        # Western Conduit
        {UNIT {ATTACKER_SIDE_NUM} {ON_DIFFICULTY "Dwarvish Guardsman" "Dwarvish Stalwart" "Dwarvish Stalwart"}  3 23 (
            random_traits=yes
            generate_name=yes
            max_moves=0
            moves=0
            ai_special=guardian
        )}

        {UNIT {ATTACKER_SIDE_NUM} {ON_DIFFICULTY "Dwarvish Guardsman" "Dwarvish Guardsman" "Dwarvish Stalwart"}  3 20 (
            random_traits=yes
            generate_name=yes
            max_moves=0
            moves=0
            ai_special=guardian
        )}

        {IF_ALIVE (4,6,8) (
            {UNIT {ATTACKER_SIDE_NUM} "Dwarvish Guardsman"  5 21 (
                random_traits=yes
                generate_name=yes
                max_moves=0
                moves=0
                ai_special=guardian
            )}

            {UNIT {ATTACKER_SIDE_NUM} "Dwarvish Guardsman"  5 22 (
                random_traits=yes
                generate_name=yes
                max_moves=0
                moves=0
                ai_special=guardian
            )}
        )}

        # Eastern Conduit
        {UNIT {ATTACKER_SIDE_NUM} {ON_DIFFICULTY "Dwarvish Guardsman" "Dwarvish Stalwart" "Dwarvish Stalwart"} 39 22 (
            random_traits=yes
            generate_name=yes
            max_moves=0
            moves=0
            ai_special=guardian
        )}

        {UNIT {ATTACKER_SIDE_NUM} {ON_DIFFICULTY "Dwarvish Guardsman" "Dwarvish Guardsman" "Dwarvish Stalwart"} 39 19 (
            random_traits=yes
            generate_name=yes
            max_moves=0
            moves=0
            ai_special=guardian
        )}

        {IF_ALIVE (4,6,8) (
            {UNIT {ATTACKER_SIDE_NUM} "Dwarvish Guardsman"  37 21 (
                random_traits=yes
                generate_name=yes
                max_moves=0
                moves=0
                ai_special=guardian
            )}

            {UNIT {ATTACKER_SIDE_NUM} "Dwarvish Guardsman" 37 20 (
                random_traits=yes
                generate_name=yes
                max_moves=0
                moves=0
                ai_special=guardian
            )}
        )}
    [/event]

    # Knalgan Alliance
    [event]
        name="turn 3"
        {IF_ALIVE 2 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Dwarvish Fighter"  9 32}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Dwarvish Ulfserker" 14 31}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Poacher" 33 10}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Thief" 28 11}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Gryphon Rider" 32 32}
            {PASSABLE_CHECK}
        )}
        # Reinforce main wave with more
        # for every team name defenders have
        {IF_ALIVE 4 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Dwarvish Guardsman" 9 32}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Footpad" 28 11}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Gryphon Rider" 32 32}
            {PASSABLE_CHECK}
        )}

        {IF_ALIVE 6 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Poacher" 9 32}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Dwarvish Ulfserker" 28 11}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Footpad" 32 32}
            {PASSABLE_CHECK}
        )}

        {IF_ALIVE 8 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Dwarvish Thunderguard" 9 32}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} {ON_DIFFICULTY "Gryphon Rider" "Gryphon Rider" "Gryphon Master"} 32 32}
            {PASSABLE_CHECK}
        )}
    [/event]

    # Undead
    [event]
        name="turn 7"
        {IF_ALIVE 2 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Ghost" 20 30}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Skeleton" 34 30}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Skeleton Archer" 30 34}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Ghoul"  6 16}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Soulless" 18  7}
            {PASSABLE_CHECK}
        )}
        # Reinforce main wave with more
        # for every team name defenders have
        {IF_ALIVE 4 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Walking Corpse" 18  7}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Walking Corpse" 18  7}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Skeleton" 30 34}
            {PASSABLE_CHECK}
        )}

        {IF_ALIVE 6 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Vampire Bat" 20 30}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Blood Bat" 20 30}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Walking Corpse" 18  7}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Skeleton Archer" 34 30}
            {PASSABLE_CHECK}
        )}

        {IF_ALIVE 8 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Ghoul"  6 16}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Vampire Bat" 20 30}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Soulless" 18  7}
            {PASSABLE_CHECK}
        )}
    [/event]

    # Dunefolk
    [event]
        name="turn 11"

        {IF_ALIVE 2 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} {ON_DIFFICULTY "Dune Soldier" "Dune Soldier" "Dune Captain"} 22 32}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Dune Explorer" 28 30}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Dune Burner"  4 27}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Dune Skirmisher" 11 27}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Dune Horse Archer" 36 23}
            {PASSABLE_CHECK}
        )}
        # Reinforce main wave with more
        # for every team name defenders have
        {IF_ALIVE 4 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Dune Soldier" 22 32}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Dune Rover" 11 27}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Dune Rider" 36 23}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Dune Rider" 36 23}
            {PASSABLE_CHECK}
        )}

        {IF_ALIVE 6 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Dune Alchemist" 22 32}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Dune Herbalist"  4 27}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Dune Rider" 36 23}
            {PASSABLE_CHECK}
        )}

        {IF_ALIVE 8 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Dune Falconer" 11 27}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Dune Skirmisher" 28 30}
            {PASSABLE_CHECK}
        )}
    [/event]

    # Northerners
    [event]
        name="turn 15"
        {IF_ALIVE 2 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} {ON_DIFFICULTY "Orcish Slayer" "Orcish Slayer" "Orcish Nightblade"} 16 32}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Goblin Pillager" 15 34}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Goblin Pillager" 32  9}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Orcish Slayer" 28 10}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Troll" 37 15}
            {PASSABLE_CHECK}
        )}
        # Reinforce main wave with more
        # for every team name defenders have
        {IF_ALIVE 4 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Orcish Grunt" 16 32}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Orcish Grunt" 16 32}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Orcish Archer" 28 10}
            {PASSABLE_CHECK}
        )}

        {IF_ALIVE 6 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Orcish Crossbowman" 32  9}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Wolf Rider" 15 34}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Wolf Rider" 15 34}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Troll Whelp" 37 15}
            {PASSABLE_CHECK}
        )}

        {IF_ALIVE 8 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Orcish Warrior" 32  9}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Goblin Spearman" 28 10}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Goblin Spearman" 28 10}
            {PASSABLE_CHECK}
        )}
    [/event]

    # Drakes
    [event]
        name="turn 19"
        {IF_ALIVE 2 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} {ON_DIFFICULTY "Fire Drake" "Inferno Drake" "Inferno Drake"} 10 9}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Drake Warrior" 13 12}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Drake Arbiter"  5 14}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Saurian Oracle"  6 25}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Sky Drake"  8 27}
            {PASSABLE_CHECK}
        )}
        # Reinforce main wave with more
        # for every team name defenders have
        {IF_ALIVE 4 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Drake Fighter" 10  9}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Drake Burner" 10  9}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Drake Glider" 8 27}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Drake Glider" 8 27}
            {PASSABLE_CHECK}
        )}

        {IF_ALIVE 6 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Drake Clasher"  5 14}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Drake Clasher"  5 14}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Saurian Ambusher"  6 25}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Saurian Skirmisher"  6 25}
            {PASSABLE_CHECK}
        )}

        {IF_ALIVE 8 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Drake Fighter" 13 12}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Saurian Augur"  6 25}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Saurian Augur"  6 25}
            {PASSABLE_CHECK}
        )}
    [/event]

    # Rebels
    [event]
        name="turn 23"
        {IF_ALIVE 2 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} {ON_DIFFICULTY "Elvish Rider" "Elvish Outrider" "Elvish Outrider"} 18  8}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Elvish Captain" 21 33}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Elvish Sorceress" 28 33}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Elvish Ranger" 35 29}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Elvish Hero" 34 15}
            {PASSABLE_CHECK}
        )}
        # Reinforce main wave with more
        # for every team name defenders have
        {IF_ALIVE 4 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Elvish Scout" 18  8}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Wose" 28 33}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Elvish Archer" 34 15}
            {PASSABLE_CHECK}
        )}
        {IF_ALIVE 6 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Elvish Scout" 18  8}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Elvish Shaman" 21 33}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Elvish Shaman" 35 29}
            {PASSABLE_CHECK}
        )}
        {IF_ALIVE 8 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Elvish Scout" 18  8}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Elvish Fighter" 21 33}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Wose" 28 33}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Elvish Shaman" 34 15}
            {PASSABLE_CHECK}
        )}
    [/event]

    # Loyalists
    [event]
        name="turn 27"
        {IF_ALIVE 2 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} {ON_DIFFICULTY "Knight" "Knight" "Lancer"} 24  8}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Swordsman" 33 17}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Pikeman" 25 32}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Arch Mage" 19 33}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Shock Trooper"  7 18}
            {PASSABLE_CHECK}
        )}
        # Reinforce main wave with more
        # for every team name defenders have
        {IF_ALIVE 4 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Cavalryman" 24  8}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Longbowman" 33 17}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Swordsman" 19 33}
            {PASSABLE_CHECK}
        )}
        {IF_ALIVE 6 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Cavalryman" 24  8}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Heavy Infantryman"  7 18}
            {PASSABLE_CHECK}

            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Duelist" 33 17}
            {PASSABLE_CHECK}
        )}
        {IF_ALIVE 8 (
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Red Mage"  7 18}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Red Mage" 19 33}
            {PASSABLE_CHECK}
            {GENERIC_UNIT {ATTACKER_SIDE_NUM} "Longbowman" 33 17}
            {PASSABLE_CHECK}
        )}
    [/event]
#enddef

#define SETUP_SCENARIO_EVENTS
    #adjust recall costs
    [event]
        name=preload
        first_time_only=no

        [lua]
            code = << wesnoth.dofile "~add-ons/Citadel_of_Drand/lua/recall_cost.lua" >>
        [/lua]
    [/event]
    # defender victory events
    [event]
        name="die"
        first_time_only=yes
        [filter]
            id="Attacker_Conduit1"
        [/filter]

        [transient_message]
            caption= _ "End Result"
            image="attacks/faerie-fire.png"
            transparent=yes
            message= _ "The Defending Team is victorious!"
        [/transient_message]

        [endlevel]
            # side=2,4,6,8
            result=victory
            carryover_report=no
            carryover_percentage=0
            bonus=no
        [/endlevel]
    [/event]

    [event]
        name="die"
        first_time_only=yes
        [filter]
            id="Attacker_Conduit2"
        [/filter]

        [transient_message]
            caption= _ "End Result"
            image="attacks/faerie-fire.png"
            transparent=yes
            message= _ "The Defending Team is victorious!"
        [/transient_message]

        [endlevel]
            # side=2,4,6,8
            result=victory
            carryover_report=no
            carryover_percentage=0
            bonus=no
        [/endlevel]
    [/event]

    [event]
        name="time over"
        first_time_only=yes

        [transient_message]
            caption= _ "End Result"
            image="attacks/faerie-fire.png"
            transparent=yes
            message= _ "The Defending Team is victorious!"
        [/transient_message]

        [endlevel]
            # side=2,4,6,8
            result=victory
            carryover_report=no
            carryover_percentage=0
            bonus=no
        [/endlevel]
    [/event]

    # attacker victory event
    [event]
        name="die"
        first_time_only=yes
        [filter]
            id="Defender_Conduit"
        [/filter]

        [transient_message]
            caption= _ "End Result"
            image="attacks/faerie-fire.png"
            transparent=yes
            message= _ "The Attacking Team is victorious!"
        [/transient_message]

        [endlevel]
            # side=1,3,5,7
            result=victory
            carryover_report=no
            carryover_percentage=0
            bonus=no
        [/endlevel]
    [/event]

    # open up attacker conduit paths
    [event]
        name="turn 6"

        # open up the walls
        {EARTHQUAKE (
            [terrain]
                terrain=Rb
                x= 5, 6, 6, 5,37,38,37,36
                y=20,20,22,23,22,22,19,19
            [/terrain]
        )}
        # indicate what has happened

        [transient_message]
            caption= _ "Update"
            image="attacks/faerie-fire.png"
            transparent=yes
            message= _ "Attacker Conduits are now exposed!"
        [/transient_message]
    [/event]

    # death of attacking team
    [event]
        name=last breath
        first_time_only=no
        [filter]
            side=1,3,5,7
            canrecruit=yes
        [/filter]
        [if]
            [have_unit]
                side=1,3,5,7
                canrecruit=yes
            [/have_unit]
            [then]
                [transient_message]
                    caption= _ "Updates"
                    image="attacks/faerie-fire.png"
                    transparent=yes
                    message= _ "One of the Attacking Commanders has fallen!"
                [/transient_message]
            [/then]
            [else]
                [transient_message]
                    caption= _ "End Result"
                    image="attacks/faerie-fire.png"
                    transparent=yes
                    message= _ "The Defending Team is victorious!"
                [/transient_message]

                [endlevel]
                    # side=1,3,5,7
                    result=victory
                    carryover_report=no
                    carryover_percentage=0
                    bonus=no
                [/endlevel]
            [/else]
        [/if]
    [/event]

    # death of defending team
    [event]
        name=last breath
        first_time_only=no
        [filter]
            side=2,4,6,8
            canrecruit=yes
        [/filter]
        [if]
            [have_unit]
                side=2,4,6,8
                canrecruit=yes
            [/have_unit]
            [then]
                [transient_message]
                    caption= _ "Updates"
                    image="attacks/faerie-fire.png"
                    transparent=yes
                    message= _ "One of the Defending Commanders has fallen!"
                [/transient_message]
            [/then]
            [else]
                [transient_message]
                    caption= _ "End Result"
                    image="attacks/faerie-fire.png"
                    transparent=yes
                    message= _ "The Attacking Team is victorious!"
                [/transient_message]

                [endlevel]
                    # side=1,3,5,7
                    result=victory
                    carryover_report=no
                    carryover_percentage=0
                    bonus=no
                [/endlevel]
            [/else]
        [/if]
    [/event]
#enddef

# if leaders die in first round
# there is a good chance of the second
# round breaking at start
# so this is added in to remove the leaders from the game board
# for the remainder of the match duration
#define SETUP_GUARD_LEADER_FIRST_ROUND
    # Attacking Side
    [event]
        name="last breath"
        [filter]
            side=1
            canrecruit=yes
        [/filter]

        {TELEPORT_UNIT (
            side=1
            canrecruit=yes
        )  2 16}

        {FULL_HEAL (
            side=1
            canrecruit=yes
        )}
    [/event]

    [event]
        name="last breath"
        [filter]
            side=3
            canrecruit=yes
        [/filter]

        {TELEPORT_UNIT (
            side=3
            canrecruit=yes
        )  2 18}

        {FULL_HEAL (
            side=3
            canrecruit=yes
        )}
    [/event]

    [event]
        name="last breath"
        [filter]
            side=5
            canrecruit=yes
        [/filter]

        {TELEPORT_UNIT (
            side=5
            canrecruit=yes
        )  2 24}

        {FULL_HEAL (
            side=5
            canrecruit=yes
        )}
    [/event]

    [event]
        name="last breath"
        [filter]
            side=7
            canrecruit=yes
        [/filter]

        {TELEPORT_UNIT (
            side=7
            canrecruit=yes
        )  2 26}

        {FULL_HEAL (
            side=7
            canrecruit=yes
        )}
    [/event]

    # Defending Side
    [event]
        name="last breath"
        [filter]
            side=2
            canrecruit=yes
        [/filter]

        {TELEPORT_UNIT (
            side=2
            canrecruit=yes
        ) 40 13}

        {FULL_HEAL (
            side=2
            canrecruit=yes
        )}
    [/event]

    [event]
        name="last breath"
        [filter]
            side=4
            canrecruit=yes
        [/filter]

        {TELEPORT_UNIT (
            side=4
            canrecruit=yes
        ) 40 16}

        {FULL_HEAL (
            side=4
            canrecruit=yes
        )}
    [/event]

    [event]
        name="last breath"
        [filter]
            side=6
            canrecruit=yes
        [/filter]

        {TELEPORT_UNIT (
            side=6
            canrecruit=yes
        ) 40 24}

        {FULL_HEAL (
            side=6
            canrecruit=yes
        )}
    [/event]

    [event]
        name="last breath"
        [filter]
            side=8
            canrecruit=yes
        [/filter]

        {TELEPORT_UNIT (
            side=8
            canrecruit=yes
        ) 40 27}

        {FULL_HEAL (
            side=8
            canrecruit=yes
        )}
    [/event]
#enddef
